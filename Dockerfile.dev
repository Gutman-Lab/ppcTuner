# Development Dockerfile for Vite React app
# Platform flag removed for faster local development
# For production builds, add: FROM --platform=linux/amd64 node:20-alpine
FROM node:20-alpine

# Build arguments for user ID mapping
ARG USER_ID=1000
ARG GROUP_ID=1000

# Install git (needed for GitHub dependencies like osd-paperjs-annotation)
RUN apk add --no-cache git

WORKDIR /app

# Install dependencies first (for better caching)
# Note: bdsa-react-components has a peer dependency from GitHub that requires git
COPY package*.json ./
RUN npm install

# Setup user with matching UID/GID from host
# This ensures files created in container have correct permissions on host
# Do this AFTER npm install since npm needs root to install packages
RUN addgroup -g ${GROUP_ID} appuser || true && \
    adduser -u ${USER_ID} -G appuser -D -s /bin/sh appuser || true && \
    chown -R ${USER_ID}:${GROUP_ID} /app

# Switch to appuser
USER appuser

# Expose Vite dev server port
EXPOSE 5173

# Start dev server with watch mode
# The actual command will be overridden by docker-compose.dev.yml
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--watch"]
